<<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mojo Claim Page</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="background">
        <div class="content">
            <img src="https://bafybeig6dpytw3q4v7vzdy6sb7q4x3apqgrvfi3zsbvb3n6wvs5unfr36i.ipfs.dweb.link?filename=480.gif" 
                 alt="Mojo Token Logo" class="logo">
            <h1 class="animated-text">Awesome Artists-Sweet Fans-Fueled by Mojo</h1>
            
            <div id="wallet-connect">
                <button id="connect-btn">Connect Wallet</button>
                <button id="claim-btn" style="display:none;">Claim Mojo</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { ThirdwebProvider, ConnectButton } from "https://cdn.jsdelivr.net/npm/@thirdweb-dev/sdk/dist/browser/thirdweb-dev-sdk.esm.js";
        import { optimism } from "https://cdn.jsdelivr.net/npm/@thirdweb-dev/chains/dist/index.js";

        const container = document.getElementById("wallet-connect");
        ThirdwebProvider.render({
          activeChain: optimism,
          clientId: "692b03efca5fa1f10f792dcf20fa172c", // Replace with your actual Thirdweb Client ID
        }, container);

        const connectBtn = document.getElementById("connect-btn");
        const claimBtn = document.getElementById("claim-btn");
        let connectedWallet = null;

        connectBtn.addEventListener("click", async () => {
          try {
            const sdk = await ThirdwebProvider.getSDK();
            await sdk.wallet.connect("metamask");
            connectedWallet = (await sdk.wallet.getAddress()).toLowerCase();
            connectBtn.style.display = "none";
            claimBtn.style.display = "block";
          } catch (error) {
            console.error("Wallet connection failed:", error);
            alert("Failed to connect wallet. Please try again.");
          }
        });

        claimBtn.addEventListener("click", async () => {
          if (!connectedWallet) {
            alert("Please connect your wallet first");
            return;
          }

          try {
            const response = await fetch("https://mojo-claim-worker.fletcher-christians-account3359.workers.dev", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ wallet: connectedWallet }),
            });
            const result = await response.json();

            if (result.status === "success") {
              alert("Mojo claimed successfully! Transaction Hash: " + result.transactionHash);
            } else {
              alert(result.message);
            }
          } catch (error) {
            console.error("Claim failed:", error);
            alert("Claim process failed. Please try again.");
          }
        });
    </script>
</body>
</html>