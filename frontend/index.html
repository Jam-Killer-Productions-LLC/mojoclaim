<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mojo Claim Page</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Load Thirdweb SDK -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/@thirdweb-dev/sdk/dist/browser/thirdweb-dev-sdk.esm.js"></script>
</head>
<body>
    <div class="background">
        <div class="content">
            <img src="https://bafybeig6dpytw3q4v7vzdy6sb7q4x3apqgrvfi3zsbvb3n6wvs5unfr36i.ipfs.dweb.link?filename=480.gif" 
                 alt="Mojo Token Logo" class="logo">
            <h1 class="animated-text">Awesome Artists-Sweet Fans-Fueled by Mojo</h1>
            <div id="app"></div>
        </div>
    </div>

    <script type="module">
        import { ThirdwebProvider, ConnectButton } from "https://cdn.jsdelivr.net/npm/@thirdweb-dev/sdk/dist/browser/thirdweb-dev-sdk.esm.js";
        import { optimism } from "https://cdn.jsdelivr.net/npm/@thirdweb-dev/chains/dist/index.js";

        const app = document.getElementById("app");

        // Render ThirdwebProvider to wrap the app
        ThirdwebProvider.render({
            activeChain: optimism,
            clientId: "692b03efca5fa1f10f792dcf20fa172c",
            children: () => {
                const div = document.createElement("div");
                div.id = "wallet-connect";

                // ConnectButton
                ConnectButton.render({
                    onConnect: async (wallet) => {
                        const connectedWallet = (await wallet.getAddress()).toLowerCase();
                        const claimBtn = document.createElement("button");
                        claimBtn.id = "claim-btn";
                        claimBtn.textContent = "Claim Mojo";
                        claimBtn.style.display = "block";
                        div.appendChild(claimBtn);

                        claimBtn.onclick = async () => {
                            try {
                                const response = await fetch("https://mojo-claim-worker.fletcher-christians-account3359.workers.dev", {
                                    method: "POST",
                                    headers: { "Content-Type": "application/json" },
                                    body: JSON.stringify({ wallet: connectedWallet }),
                                });
                                const result = await response.json();
                                if (result.status === "success") {
                                    alert(`Connected! Wallet: ${result.wallet}`);
                                } else {
                                    alert(`Error: ${result.message}`);
                                }
                            } catch (error) {
                                console.error("Claim failed:", error);
                                alert("Claim failed.");
                            }
                        };
                    },
                    onDisconnect: () => {
                        const claimBtn = document.getElementById("claim-btn");
                        if (claimBtn) claimBtn.remove();
                    }
                }, div);

                return div;
            }
        }, app);
    </script>
</body>
</html>